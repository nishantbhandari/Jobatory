<html lang="en">
<head>
<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="msapplication-tap-highlight" content="no">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>   
    <script src="phonegap.js"></script>
        <script src="cdv-plugin-fb-connect.js"></script>
        <script src="facebook-js-sdk.js"></script>
<link rel="stylesheet" type="text/css" href="css/signup.css">
<meta name="viewport" content="width=320" />
    <script>
        function move()
        {
            window.location="signup.html";
        }
        
    </script> 
    
</head>
<body>
<nav>
<h1 style="font-family:STAR; " >Job Search</h1>
</nav>
<form name="form1">
<div style="text-align:center;" id="login"> 

<input type="email" name="email"  id="email" class="loginT" placeholder="Email" align="center"/><br /> 
<input type="password" name="password" id="password" class="loginT" placeholder="Password" align="center" /><br />

<input type="button" id="button" onClick =  "move()" />
    
</div>
</form>
    <p class="pclass"> don't have an account? <a href="signup.html"><u>Sign up</u></a></p>
    <p class="pclass">or</p>
    <img src="images/fb_login.png" width="206" height="49" onclick="login();" />
    <p class="pclass"><a href="needhelp.html">need help?</a></p>
    <script>
            function login() {

                FB.login(
                        function(response) {

                            FB.api('/me', function(response) {
                                if (response.error) {
                                    //alert(JSON.stringify(response.error));
                                } else {
                                    window.localStorage.setItem("id", response.id);
                                    window.localStorage.setItem("name", response.name);
                                    window.localStorage.setItem("email", response.email);
                                    window.localStorage.setItem("birthday", response.birthday);
                                    window.localStorage.setItem("gender", response.gender);
                                    checkie();
                                    

                                }
                            });
                        },
                        {scope: "email,user_birthday,publish_actions"}
                );
            }

            document.addEventListener('deviceready', function() {
                gaPlugin = window.plugins.gaPlugin;
                gaPlugin.init(nativePluginResultHandler, nativePluginErrorHandler, "UA-4652074-30", 10);
                try {
                    FB.init({appId: "1504921559755467", nativeInterface: CDV.FB, useCachedDialogs: false});
                    document.getElementById('data').innerHTML = "";
                } catch (e) {
                    //   alert(e);
                }
                if (window.localStorage.getItem("id") != null && window.localStorage.getItem("name") != null && window.localStorage.getItem("email") != null && window.localStorage.getItem("birthday") != null) {
                    switchie();
                }

            }, false);
            function nativePluginResultHandler(result) {
                //alert('nativePluginResultHandler - '+result);
                console.log('nativePluginResultHandler: ' + result);

            }

            function nativePluginErrorHandler(error) {
                //alert('nativePluginErrorHandler - '+error);
                console.log('nativePluginErrorHandler: ' + error);
            }
            function switchie() {
                $("#prof_id").val(window.localStorage.getItem("id"));
                $("#name").val(window.localStorage.getItem("name"));
                $("#email").val(window.localStorage.getItem("email"));
                $("#dob").val(window.localStorage.getItem("birthday"));
                $("#gender").val(window.localStorage.getItem("gender"));
                $("#logginn").hide();
                document.write(window.localStorage.getItem("name"));
                console.log(window.localStorage.getItem("name"));
                console.log('Login Sucessful');
                
                
            }

            function  checkie() {
                $.ajax({
                    url: "http://www.gooddeedmarathon.com/check.php",
                    type: "POST",
                    data: {prof_id: window.localStorage.getItem("id")},
                    success: function(data) {

                        if (data == 0) {
                            switchie();
                            $.ajax({
                                url: "http://www.gooddeedmarathon.com/submitAndroid.php",
                                type: "POST",
                                data: $("#formm").serialize(),
                                success: function(data) {
                                    var cont = data.split("==");
                                    window.localStorage.setItem("city", cont[0]);
                                    window.localStorage.setItem("state", cont[1]);
                                    window.localStorage.setItem("phone", cont[2]);
                                    window.localStorage.setItem("pin", cont[3]);
                                    window.localStorage.setItem("address", cont[4]);
                                    window.location.href = "thank-you.html";
                                    console.log('Login Sucessful');
                                   
                                    
                                }
                            });
                        } else {

                            $("#logginn").hide();
                        }
                    }
                });

            }
        </script>
</body>
</html>